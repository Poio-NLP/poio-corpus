{% extends "base.j2" %}

{% block custom_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='media/css/prediction.css') }}">
{% endblock custom_css %}

{% block main %}

<h1>
    Text prediction
</h1>

<p>
    <textarea id="prediction" name="prediction" rows="10" cols="50"></textarea><br/>
    <div id="predictor">
        <span class="predicted-word"><span class="shortcut">F1</span><span id="predict-0"></span></span>
        <span class="predicted-word"><span class="shortcut">F2</span><span id="predict-1"></span></span>
        <span class="predicted-word"><span class="shortcut">F3</span><span id="predict-2"></span></span>
        <span class="predicted-word"><span class="shortcut">F4</span><span id="predict-3"></span></span>
        <span class="predicted-word"><span class="shortcut">F5</span><span id="predict-4"></span></span>
        <span class="predicted-word"><span class="shortcut">F6</span><span id="predict-5"></span></span>
    </div>
</p>

{% endblock %}

{% block scripts %}

<script type=text/javascript>
$(function() {
    $('textarea#prediction').bind('input propertychange', function() {
        $.getJSON($SCRIPT_ROOT + '/_prediction', {
            text: $('textarea[name="prediction"]').val(),
            iso : '{{ iso }}'
        }, function(data) {
            var length = data.length, element = null;
            for (var i = 0; i < length; i++) {
                element = data[i];
                $("#predict-" + i).text(element)
            }
        });
        return false;
    });
    $('textarea#prediction').keypress(function(event) {
        if ( ( event.keyCode == 112 ) ||
                ( event.keyCode == 113 ) ||
                ( event.keyCode == 114 ) ||
                ( event.keyCode == 115 ) ||
                ( event.keyCode == 116 ) ||
                ( event.keyCode == 117 ) ) { //112-123
            event.preventDefault();
            i = event.keyCode - 112;
            text = $("#predict-" + i).text();
            prevText = $('textarea[name="prediction"]').val();
            newText = prevText.substr(0, prevText.lastIndexOf(" "));
            newText += " ";
            newText += text;
            newText += " ";
            $('textarea[name="prediction"]').val(newText)
        }        
    });
});
</script>

{% endblock scripts %}